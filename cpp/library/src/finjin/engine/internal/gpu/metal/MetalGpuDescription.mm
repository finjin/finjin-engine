//Copyright (c) 2017 Finjin
//
//This file is part of Finjin Engine (finjin-engine).
//
//Finjin Engine is distributed in the hope that it will be useful,
//but WITHOUT ANY WARRANTY; without even the implied warranty of
//MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
//
//This Source Code Form is subject to the terms of the Mozilla Public
//License, v. 2.0. If a copy of the MPL was not distributed with this
//file, You can obtain one at http://mozilla.org/MPL/2.0/.


//Includes----------------------------------------------------------------------
#include "FinjinPrecompiled.hpp"

#if FINJIN_TARGET_GPU_SYSTEM == FINJIN_TARGET_GPU_SYSTEM_METAL

#include "MetalGpuDescription.hpp"
#include "MetalIncludes.hpp"

using namespace Finjin::Engine;


//Local data--------------------------------------------------------------------
static const MetalFeatureSet standardFeatureSets[] =
{
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_IOS
    //iOS_GPUFamily1_v1
    {
        MTLFeatureSet_iOS_GPUFamily1_v1, Version(1, 1),
        //Availability
        {
            true,
            false,
            true,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            31,
            16,
            31,
            4000,
            512,
            16352,
            16,
            (size_t)-1,
            60,
            60,
            0,
            0,
            256000000,
            4,
            4096,
            4096,
            4096,
            2048,
            2048,
            64,
            64,
            4,
            511,
            16,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_IOS
    //iOS_GPUFamily2_v1
    {
        MTLFeatureSet_iOS_GPUFamily2_v1, Version(2, 1),
        //Availability
        {
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            31,
            16,
            31,
            4000,
            512,
            16352,
            16,
            (size_t)-1,
            60,
            60,
            0,
            0,
            256000000,
            4,
            4096,
            4096,
            4096,
            2048,
            2048,
            64,
            64,
            8,
            511,
            32,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_IOS
    //iOS_GPUFamily1_v2
    {
        MTLFeatureSet_iOS_GPUFamily1_v2, Version(1, 2),
        //Availability
        {
            true,
            false,
            true,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            31,
            16,
            31,
            4000,
            512,
            16352,
            16,
            (size_t)-1,
            60,
            60,
            0,
            0,
            256000000,
            4,
            8192,
            8192,
            8192,
            2048,
            2048,
            64,
            64,
            4,
            511,
            16,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_IOS
    //iOS_GPUFamily2_v2
    {
        MTLFeatureSet_iOS_GPUFamily2_v2, Version(2, 2),
        //Availability
        {
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            31,
            16,
            31,
            4000,
            512,
            16352,
            16,
            (size_t)-1,
            60,
            60,
            0,
            0,
            256000000,
            4,
            8192,
            8192,
            8192,
            2048,
            2048,
            64,
            64,
            8,
            511,
            32,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_IOS
    //iOS_GPUFamily3_v1
    {
        MTLFeatureSet_iOS_GPUFamily3_v1, Version(3, 1),
        //Availability
        {
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            true,
            true,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            31,
            16,
            31,
            4000,
            512,
            16000,
            16,
            (size_t)-1,
            60,
            60,
            0,
            0,
            256000000,
            4,
            16384,
            16384,
            16384,
            2048,
            2048,
            16,
            16,
            8,
            511,
            32,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_IOS
    //iOS_GPUFamily1_v3
    {
        MTLFeatureSet_iOS_GPUFamily1_v3, Version(1, 3),
        //Availability
        {
            true,
            false,
            true,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            true,
            true,
            true,
            false,
            false,
            false,
            true,
            false,
            false,
            false,
            true,
            true,
            false,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            31,
            16,
            31,
            4000,
            512,
            16352,
            16,
            (size_t)-1,
            60,
            60,
            65536,
            0,
            256000000,
            4,
            8192,
            8192,
            8192,
            2048,
            2048,
            64,
            64,
            4,
            511,
            16,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_IOS
    //iOS_GPUFamily2_v3
    {
        MTLFeatureSet_iOS_GPUFamily2_v3, Version(2, 3),
        //Availability
        {
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            true,
            true,
            true,
            false,
            false,
            false,
            true,
            false,
            false,
            false,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            31,
            16,
            31,
            4000,
            512,
            16352,
            16,
            (size_t)-1,
            60,
            60,
            65536,
            0,
            256000000,
            4,
            8192,
            8192,
            8192,
            2048,
            2048,
            64,
            64,
            8,
            511,
            32,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_IOS
    //iOS_GPUFamily3_v2
    {
        MTLFeatureSet_iOS_GPUFamily3_v2, Version(3, 2),
        //Availability
        {
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            true,
            true,
            true,
            true,
            false,
            false,
            false,
            true,
            true,
            true,
            true,
            true,
            false,
            true,
            true,
            false,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            31,
            16,
            31,
            4000,
            512,
            16000,
            16,
            (size_t)-1,
            60,
            60,
            65536,
            16,
            256000000,
            4,
            16384,
            16384,
            16384,
            2048,
            2048,
            16,
            16,
            8,
            511,
            32,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_TVOS
    //tvOS_GPUFamily1_v1
    {
        MTLFeatureSet_tvOS_GPUFamily1_v1, Version(1, 1),
        //Availability
        {
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            31,
            16,
            31,
            4000,
            512,
            16352,
            16,
            (size_t)-1,
            60,
            60,
            0,
            0,
            256000000,
            4,
            8192,
            8192,
            8192,
            2048,
            2048,
            64,
            64,
            8,
            511,
            32,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_TVOS
    //tvOS_GPUFamily1_v2
    {
        MTLFeatureSet_tvOS_GPUFamily1_v2, Version(1, 2),
        //Availability
        {
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            true,
            true,
            true,
            false,
            false,
            false,
            true,
            false,
            false,
            false,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            31,
            16,
            31,
            4000,
            512,
            16352,
            16,
            (size_t)-1,
            60,
            60,
            65536,
            0,
            256000000,
            4,
            8192,
            8192,
            8192,
            2048,
            2048,
            64,
            64,
            8,
            511,
            32,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_MACOS
    //OSX_GPUFamily1_v1
    {
        MTLFeatureSet_OSX_GPUFamily1_v1, Version(1, 1),
        //Availability
        {
            true,
            false,
            false,
            false,
            false,
            false,
            true,
            false,
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
        },
        //Limits
        {
            31,
            31,
            128,
            16,
            31,
            4000,
            1024,
            32000,
            16,
            64000,
            32,
            128,
            0,
            0,
            256000000,
            256,
            16384,
            16384,
            16384,
            2048,
            2048,
            256,
            0,
            8,
            511,
            (size_t)-1,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_MACOS
    //OSX_GPUFamily1_v2
    {
        MTLFeatureSet_OSX_GPUFamily1_v2, Version(1, 2),
        //Availability
        {
            true,
            false,
            false,
            false,
            false,
            false,
            true,
            false,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            false,
            false,
            true,
            true,
            true,
            false,
            true,
            true,
            false,
            true,
            true,
            true,
            false,
            true,
            true,
            false,
            false,
            false,
            true,
            true,
        },
        //Limits
        {
            31,
            31,
            128,
            16,
            31,
            4000,
            1024,
            32000,
            16,
            64000,
            32,
            128,
            65536,
            64,
            1000000000,
            256,
            16384,
            16384,
            16384,
            2048,
            2048,
            256,
            0,
            8,
            511,
            (size_t)-1,
            65528,
        },
        //Capabilities
        {
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE | MetalFeatureSetCapability::BLEND,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::WRITE | MetalFeatureSetCapability::COLOR | MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::ALL,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::NONE,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::FILTER | MetalFeatureSetCapability::MSAA | MetalFeatureSetCapability::RESOLVE,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::MSAA,
            MetalFeatureSetCapability::NONE,
        },
    },
#endif
};
static bool GetStandardFeatureSet(MetalFeatureSet& result, MTLFeatureSet gpuFamily)
{
    for (size_t featureSetIndex = 0; featureSetIndex < FINJIN_COUNT_OF(standardFeatureSets); featureSetIndex++)
    {
        if (standardFeatureSets[featureSetIndex].gpuFamily == gpuFamily)
        {
            result = standardFeatureSets[featureSetIndex];
            return true;
        }
    }
    return false;
}


//Implementation----------------------------------------------------------------
//MetalGpuDescription
MetalGpuDescription::MetalGpuDescription()
{
    this->isLowPower = false;
    this->isHeadless = false;
    FINJIN_ZERO_ITEM(this->maxThreadsPerThreadgroup);
    this->recommendedMaxWorkingSetSize = 0;
    FINJIN_ZERO_ITEM(this->featureSet);
    this->supportsReadWriteTexturesTier2 = false;
}

const Utf8String& MetalGpuDescription::GetGpuID() const
{
    return this->gpuID;
}

uint64_t MetalGpuDescription::GetDedicatedDeviceMemorySize() const
{
    return this->recommendedMaxWorkingSetSize;
}

uint64_t MetalGpuDescription::GetDedicatedSystemMemorySize() const
{
    return 0; //Returning 0 has the effect of rating host GPU memory the same as device GPU memory
}

uint64_t MetalGpuDescription::GetTotalDedicatedMemorySize() const
{
    return GetDedicatedDeviceMemorySize() + GetDedicatedSystemMemorySize();
}

bool MetalGpuDescription::SetStandardFeatureSet(uint32_t gpuFamily)
{
    return ::GetStandardFeatureSet(this->featureSet, static_cast<MTLFeatureSet>(gpuFamily));
}

Utf8String MetalGpuDescription::GetFeatureSetString() const
{
    Utf8String featureLevelVersionString;
#if FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_MACOS
    featureLevelVersionString = "macos_";
#elif FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_IOS
    featureLevelVersionString = "ios_";
#elif FINJIN_TARGET_PLATFORM == FINJIN_TARGET_PLATFORM_TVOS
    featureLevelVersionString = "tvos_";
#endif
    featureLevelVersionString += this->featureSet.version.ToString();

    return featureLevelVersionString;
}

//MetalHardwareGpuDescriptions
void MetalHardwareGpuDescriptions::SortBestToWorst()
{
    std::sort(begin(), end(), [](const MetalGpuDescription& a, const MetalGpuDescription& b)
    {
        if (a.featureSet.gpuFamily != b.featureSet.gpuFamily)
        {
            //Order by feature set
            return a.featureSet.gpuFamily > b.featureSet.gpuFamily;
        }

        if (a.isLowPower != b.isLowPower)
        {
            //Order by low power/high power
            auto aPower = a.isLowPower ? 0 : 1;
            auto bPower = b.isLowPower ? 0 : 1;
            return aPower > bPower;
        }

        //Order by recommended maximum working set size
        return a.recommendedMaxWorkingSetSize > b.recommendedMaxWorkingSetSize;
    });
}

const MetalGpuDescription* MetalHardwareGpuDescriptions::GetByGpuID(const Utf8String& gpuID) const
{
    for (const auto& desc : *this)
    {
        if (gpuID == desc.gpuID)
            return &desc;
    }

    return nullptr;
}

#endif
